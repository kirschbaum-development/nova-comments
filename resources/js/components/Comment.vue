<template>
    <div class="commenter__comment py-4 border-t border-40">
        <div class="font-light text-80 text-sm">
            <template v-if="hasCommenter">
                <a class="no-underline dim text-primary font-bold" :href="commenterUrl" v-text="commenter"></a>

                {{ __('said') }}
            </template>

            <template v-else>
                {{ __('Written') }}
            </template>

            {{ date }}
        </div>

        <div class="mt-2" v-html="commentString"></div>
    </div>
</template>

<script>
    // require('moment-timezone');

    export default {
        props: {
            comment: {
                type: Object,
                required: true
            }
        },

        computed: {
            commentString() {
                return _.find(this.comment.fields, { attribute: 'comment' }).value;
            },

            commenter() {
                return _.find(this.comment.fields, { attribute: 'commenter' }).value;
            },

            commenterUrl() {
                let commenterId = _.find(this.comment.fields, { attribute: 'commenter' }).belongsToId;

                return `/nova/resources/users/${commenterId}`;
            },

            date() {
                const language = Nova.app.__('Moment Locale');
                moment.locale(language)
                let now = moment();
                let date = moment.utc(_.find(this.comment.fields, { attribute: 'created_at' }).value)
                    .tz(moment.tz.guess());

                if (date.isSame(now, 'minute')) {
                    return Nova.app.__('just now');
                }

                if (date.isSame(now, 'day')) {
                    return Nova.app.__('at') + ' ' + date.format('LT');
                }

                if (date.isSame(now, 'year')) {
                    return Nova.app.__('on') + ' ' + (language === 'de' ? date.format('D MMM') : date.format('MMM D'));
                }

                return Nova.app.__('on') + ' ' + date.format('ll');
            },

            hasCommenter() {
                return Boolean(this.commenter);
            }
        }
    }
</script>
